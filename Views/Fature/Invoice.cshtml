@model PROJEKTDB.Models.Fature

@{
    ViewData["Title"] = $"Fatura #{Model.FatId}";
    var total = (decimal)(ViewBag.Total ?? 0m);
}

<div class="invoice-card">
    <div class="invoice-header">
        <div>
            <div class="brand">PROJEKTDB</div>
            <div class="muted">Galeria / Dyqan</div>
            <div class="muted">Adresa: ________</div>
            <div class="muted">Tel: ________</div>
        </div>

        <div class="invoice-meta">
            <div class="invoice-no">FATURË</div>
            <div><span class="muted">Nr:</span> <strong>#@Model.FatId</strong></div>
            <div><span class="muted">Data:</span> @Model.FatDat.ToString("dd/MM/yyyy HH:mm")</div>
        </div>
    </div>

    <hr />

    <div class="invoice-row">
        <div class="box">
            <div class="box-title">Klienti</div>
            <div><strong>@Model.Person?.PerEm @Model.Person?.PerMb</strong></div>
            <div class="muted">ID: @Model.PerId</div>
        </div>

        <div class="box">
            <div class="box-title">Detaje</div>
            <div class="muted">Pagesa: Cash / Card</div>
            <div class="muted">Status: Paid</div>
        </div>
    </div>

    <table class="invoice-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Produkti</th>
                <th class="right">Sasia</th>
                <th class="right">Çmimi</th>
                <th class="right">Nëntotali</th>
            </tr>
        </thead>
        <tbody>
        @{
            var i = 0;
            foreach (var r in Model.Rresht.OrderBy(x => x.RreId))
            {
                i++;
                var subt = (decimal)r.RreSasi * r.RreCmim;
        }
        }
        @foreach (var r in Model.Rresht.OrderBy(x => x.RreId))
        {
            var subt = (decimal)r.RreSasi * r.RreCmim;
            <tr>
                <td>@r.RreId</td>
                <td>@(r.Pikture?.PikTit ?? r.PikId)</td>
                <td class="right">@r.RreSasi</td>
                <td class="right">@r.RreCmim.ToString("0.00")</td>
                <td class="right">@subt.ToString("0.00")</td>
            </tr>
        }
        </tbody>
    </table>

    <div class="totals">
        <div class="totals-box">
            <div class="line">
                <span class="muted">Nëntotal</span>
                <span>@total.ToString("0.00") €</span>
            </div>
            <div class="line">
                <span class="muted">TVSH (0%)</span>
                <span>0.00 €</span>
            </div>
            <div class="line total">
                <span>TOTAL</span>
                <span>@total.ToString("0.00") €</span>
            </div>
        </div>
    </div>

    <div class="invoice-footer">
        <div class="muted">Faleminderit për blerjen!</div>
        <div class="actions no-print">
            <a class="btn btn-secondary" asp-action="MyInvoices">Back</a>
            <a class="btn btn-primary" asp-action="Pdf" asp-route-id="@Model.FatId">Shkarko PDF</a>
            <button class="btn btn-outline" onclick="window.print()">Print</button>
        </div>
    </div>
</div>

<style>
    .invoice-card{
        max-width: 900px;
        margin: 20px auto;
        padding: 24px;
        border: 1px solid rgba(255,255,255,.12);
        border-radius: 16px;
        background: rgba(0,0,0,.25);
        backdrop-filter: blur(8px);
    }
    .invoice-header{
        display:flex;
        justify-content:space-between;
        gap:20px;
    }
    .brand{ font-size:22px; font-weight:700; letter-spacing:.5px; }
    .muted{ opacity:.75; }
    .invoice-meta{ text-align:right; }
    .invoice-no{ font-size:18px; font-weight:700; margin-bottom:6px; }
    .invoice-row{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:14px;
        margin:16px 0;
    }
    .box{
        padding:14px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,.10);
        background: rgba(255,255,255,.04);
    }
    .box-title{ font-weight:700; margin-bottom:6px; opacity:.9; }
    .invoice-table{
        width:100%;
        border-collapse: collapse;
        margin-top: 10px;
        overflow:hidden;
        border-radius: 12px;
    }
    .invoice-table th, .invoice-table td{
        padding: 10px 12px;
        border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .invoice-table thead th{
        background: rgba(255,255,255,.06);
        font-weight:700;
    }
    .right{ text-align:right; }
    .totals{
        display:flex;
        justify-content:flex-end;
        margin-top: 14px;
    }
    .totals-box{
        width: 320px;
        padding: 14px;
        border-radius: 12px;
        border:1px solid rgba(255,255,255,.10);
        background: rgba(255,255,255,.04);
    }
    .line{ display:flex; justify-content:space-between; padding:6px 0; }
    .line.total{ font-weight:800; font-size:16px; border-top:1px solid rgba(255,255,255,.10); margin-top:6px; padding-top:10px;}
    .invoice-footer{
        margin-top: 18px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:12px;
    }
    .btn{ padding:8px 12px; border-radius:10px; text-decoration:none; display:inline-block; }
    .btn-primary{ background:#2563eb; color:white; }
    .btn-secondary{ background:rgba(255,255,255,.12); color:white; }
    .btn-outline{ border:1px solid rgba(255,255,255,.25); color:white; background:transparent; }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; }

    @@media print{
        .no-print{ display:none !important; }
        body{ background: white !important; color: black !important; }
        .invoice-card{ background:white !important; border: 1px solid #ddd !important; }
        .invoice-table thead th{ background:#f2f2f2 !important; }
        .muted{ opacity:1 !important; color:#444 !important; }
    }
</style>
